<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestão de Notas Fiscais UNA</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #0a0a0f;
    color: #dbe9ff;
    margin: 0;
    overflow-x: hidden;
  }

  header {
    background: linear-gradient(90deg, #001f3f, #003c8f);
    color: white;
    text-align: center;
    padding: 25px;
    font-size: 1.8em;
    font-weight: bold;
    letter-spacing: 1px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }

  nav {
    display: flex;
    justify-content: center;
    background: #101820;
    padding: 15px;
    gap: 10px;
    border-bottom: 2px solid #0d47a1;
  }

  nav button {
    background: #0277bd;
    color: white;
    border: none;
    border-radius: 30px;
    padding: 10px 25px;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 10px rgba(2,119,189,0.4);
  }

  nav button:hover, nav button.active {
    background: #039be5;
    box-shadow: 0 0 20px rgba(3,155,229,0.8);
    transform: scale(1.05);
  }

  section {
    display: none;
    max-width: 1000px;
    margin: 40px auto;
    background: #101820;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.6);
  }

  section.active {
    display: block;
  }

  #searchInput {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #0d47a1;
    margin-bottom: 15px;
    background-color: #0f1722;
    color: #dbe9ff;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    color: #dbe9ff;
  }

  th, td {
    border: 1px solid #1e3a8a;
    padding: 10px;
    text-align: center;
  }

  th {
    background: #0d47a1;
    color: white;
  }

  tr:nth-child(even) {
    background-color: #0f1722;
  }

  tr:nth-child(odd) {
    background-color: #152238;
  }

  tr:hover {
    background-color: #1e3a8a;
  }

  a {
    color: #29b6f6;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  .pagination {
    margin-top: 15px;
    text-align: center;
  }

  .pagination button {
    background: #0277bd;
    color: white;
    border: none;
    border-radius: 8px;
    margin: 2px;
    padding: 5px 10px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .pagination button.active,
  .pagination button:hover {
    background: #039be5;
  }
</style>
</head>
<body>

<header>Gestão de Notas Fiscais UNA</header>

<nav>
  <button id="btnView" class="active">Visualizar NFs</button>
</nav>

<section id="viewSection" class="active">
  <input type="text" id="searchInput" placeholder="Pesquisar por NF ou Razão Social...">
  
  <table id="nfTable">
    <thead>
      <tr>
        <th>Data/Hora</th>
        <th>Razão Social</th>
        <th>Nº NF Venda</th>
        <th>Nº NF Remessa</th>
        <th>Nº NF Cobertura</th>
        <th>Fábrica</th>
        <th>PDF</th>
        <th>Observação</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="8" style="text-align:center;">Carregando...</td></tr>
    </tbody>
  </table>

  <div class="pagination" id="pagination"></div>
</section>

<script>
const webAppURL = "https://script.google.com/macros/s/AKfycbyPdj_FtFywyV4Ey4b3-Q6YV3RcgXzsEUux6ceK23cdJTh71paHQ9HMD5Ts-pFOomUX/exec";
let allData = [];
let currentPage = 1;
const rowsPerPage = 10;

document.addEventListener("DOMContentLoaded", carregarNFs);
document.getElementById("searchInput").addEventListener("input", () => { currentPage = 1; aplicarFiltro(); });

async function carregarNFs() {
  try {
    const response = await fetch(webAppURL + "?action=get");
    const data = await response.json();
    // Filtra apenas as notas da UNA
    allData = data.filter(r => r.fabrica && r.fabrica.toLowerCase() === "una");
    aplicarFiltro();
  } catch (err) {
    console.error("Erro ao carregar dados:", err);
  }
}

function aplicarFiltro() {
  const search = document.getElementById("searchInput").value.toLowerCase();
  const filtrados = allData.filter(r =>
    (!search ||
      r.razao.toLowerCase().includes(search) ||
      r.nfVenda.toLowerCase().includes(search))
  );
  renderTabela(filtrados);
}

function renderTabela(data) {
  const tbody = document.querySelector("#nfTable tbody");
  tbody.innerHTML = "";
  if (data.length === 0) {
    tbody.innerHTML = '<tr><td colspan="8">Nenhuma NF encontrada.</td></tr>';
    document.getElementById("pagination").innerHTML = "";
    return;
  }

  const totalPages = Math.ceil(data.length / rowsPerPage);
  if (currentPage > totalPages) currentPage = 1;
  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  const pageData = data.slice(start, end);

  pageData.forEach(r => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${new Date(r.dataHora).toLocaleString()}</td>
      <td>${r.razao}</td>
      <td>${r.nfVenda}</td>
      <td>${r.nfRemessa}</td>
      <td>${r.nfCobertura}</td>
      <td>${r.fabrica}</td>
      <td>${r.pdfLink ? `<a href="${r.pdfLink}" target="_blank">Abrir PDF</a>` : "—"}</td>
      <td>${r.observacao || ""}</td>
    `;
    tbody.appendChild(tr);
  });

  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";
  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.innerText = i;
    if (i === currentPage) btn.classList.add("active");
    btn.addEventListener("click", () => { currentPage = i; renderTabela(data); });
    pagination.appendChild(btn);
  }
}
</script>

</body>
</html>
